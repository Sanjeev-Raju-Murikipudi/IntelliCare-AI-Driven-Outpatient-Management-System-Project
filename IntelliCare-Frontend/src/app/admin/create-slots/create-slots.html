<div class="container-fluid py-4">
  <div class="card shadow">
    <!-- Header -->
    <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
      <h3 class="card-title my-2">Doctor Slots </h3>
      <button class="btn btn-warning" (click)="openCreateModal()">
        <i class="bi bi-plus-circle me-1"></i> Create New Slot
      </button>
    </div>

    <div class="card-body">
      <!-- Alerts -->
      <div *ngIf="customAlertMessage" class="alert alert-info alert-dismissible fade show" role="alert">
        {{ customAlertMessage }}
        <button type="button" class="btn-close" (click)="customAlertMessage = null" aria-label="Close"></button>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
        <strong>Error:</strong> {{ errorMessage }}
      </div>

      <!-- Doctor Dropdown -->
      <div class="mb-4">
        <label class="form-label fw-bold">Select Doctor to View Availability</label>
        <select class="form-select" [(ngModel)]="selectedDoctorId" (change)="onDoctorSelect()">
          <option value="">Choose a doctor</option>
          <option *ngFor="let doc of doctors" [value]="doc.doctorId">
            {{ doc.name }} - {{ doc.specialization }}
          </option>
        </select>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center p-5">
        <div class="spinner-border text-secondary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-secondary">Fetching available slots...</p>
      </div>

      <!-- Available Slots Table -->
      <div *ngIf="availableSlots.length > 0 && !loading" class="table-responsive">
        <table class="table table-striped table-hover table-sm align-middle">
          <thead class="bg-light">
            <tr>
              <th>Doctor Name</th>
              <th>Date & Time</th>
              <th>Status</th>
              <th>Fee (₹)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let slot of availableSlots">
              <td>{{ slot.doctorName }}</td>
              <td>{{ slot.date_Time | date:'medium' }}</td>
              <td>
                <span class="badge bg-success" *ngIf="slot.status === 'Available'">{{ slot.status }}</span>
                <span class="badge bg-secondary" *ngIf="slot.status !== 'Available'">{{ slot.status }}</span>
              </td>
              <td>₹{{ slot.appointmentFee }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="availableSlots.length === 0 && !loading" class="text-muted mt-3">
        No available slots for this doctor.
      </div>
    </div>
  </div>
</div>

<!-- Create Slot Modal -->
<div class="app-modal" [class.is-open]="isModalOpen">
  <div class="app-modal-content card shadow">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Create New Slot</h4>
      <button type="button" class="btn-close btn-close-white" (click)="closeCreateModal()" aria-label="Close"></button>
    </div>
    <div class="card-body">
      <form [formGroup]="slotForm" (ngSubmit)="saveSlot()">
        <!-- Doctor Dropdown -->
        <div class="mb-3">
          <label class="form-label">Select Doctor</label>
          <select class="form-select" formControlName="doctorID" required>
            <option value="">Select Doctor</option>
            <option *ngFor="let doc of doctors" [value]="doc.doctorId">
              {{ doc.name }} - {{ doc.specialization }}
            </option>
          </select>
        </div>

        <!-- Date -->
        <div class="mb-3">
          <label class="form-label">Date</label>
          <input type="date" class="form-control" formControlName="date" required>
        </div>

        <!-- Start Time -->
        <div class="mb-3">
          <label class="form-label">Start Time</label>
          <input type="time" class="form-control" formControlName="startTime" required>
        </div>

        <!-- End Time -->
        <div class="mb-3">
          <label class="form-label">End Time</label>
          <input type="time" class="form-control" formControlName="endTime" required>
        </div>

        <!-- Interval -->
        <div class="mb-3">
          <label class="form-label">Interval (minutes)</label>
          <input type="number" class="form-control" formControlName="intervalMinutes" required>
        </div>

        <!-- Fee -->
        <div class="mb-3">
          <label class="form-label">Fee (₹)</label>
          <input type="number" class="form-control" formControlName="fee" required>
        </div>

        <!-- Buttons -->
        <div class="d-flex justify-content-end">
          <button type="submit" class="btn btn-success me-2" [disabled]="loading">Create Slot</button>
          <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>