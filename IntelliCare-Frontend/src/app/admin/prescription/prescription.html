<div class="prescription-container">
  <!-- Filters -->
  <div class="row mb-3">
    <div class="col-md-6">
      <input type="text" class="form-control" placeholder="Search by patient name"
             [(ngModel)]="searchPatient" (input)="applyFilters()" />
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="filterStatus" (change)="applyFilters()">
        <option value="">All Statuses</option>
        <option value="Not yet Delivered">Not yet Delivered</option>
        <option value="Ready to Deliver">Ready to Deliver</option>
        <option value="Delivered">Delivered</option>
      </select>
    </div>
  </div>

  <!-- Toasts -->
  <div *ngIf="success" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="fas fa-check-circle me-2"></i> {{ success }}
    <button type="button" class="btn-close" (click)="success = ''"></button>
  </div>
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-circle me-2"></i> {{ error }}
    <button type="button" class="btn-close" (click)="error = ''"></button>
  </div>

  <!-- Table -->
  <div class="table-responsive" *ngIf="!loading && filteredPrescriptions.length > 0">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>Patient</th>
          <th>Doctor</th>
          <th>Medication</th>
          <th>Status</th>
          <th>ETA</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of paginatedPrescriptions()">
          <td>{{ p.patientName }}</td>
          <td>{{ p.doctorName }} ({{ p.doctorSpecialty }})</td>
          <td>{{ p.medicationDetails }}</td>
          <td>
            <select [(ngModel)]="p.pharmacyStatus" class="form-select form-select-sm">
              <option value="Not yet Delivered">Not yet Delivered</option>
              <option value="Ready to Deliver">Ready to Deliver</option>
              <option value="Delivered">Delivered</option>
            </select>
          </td>
          <td>
            <input *ngIf="p.pharmacyStatus !== 'Delivered'" type="text"
                   [(ngModel)]="p.deliveryETA" class="form-control form-control-sm"
                   placeholder="e.g., 2 hours" />
            <span *ngIf="p.pharmacyStatus === 'Delivered'">{{ p.deliveryETA || 'N/A' }}</span>
          </td>
          <td>
            <button class="btn btn-sm btn-primary" (click)="updatePrescription(p)">
              <i class="fas fa-save me-1"></i> Save
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

 <!-- Pagination -->
<nav *ngIf="filteredPrescriptions.length > pageSize" class="mt-3">
  <ul class="pagination justify-content-end">
    <li class="page-item" [class.disabled]="currentPage === 1">
      <button class="page-link" (click)="goToPage(currentPage - 1)">Previous</button>
    </li>
    <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === i + 1">
      <button class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</button>
    </li>
    <li class="page-item" [class.disabled]="currentPage === totalPages">
      <button class="page-link" (click)="goToPage(currentPage + 1)">Next</button>
    </li>
  </ul>
</nav>

  <!-- No Data -->
  <div *ngIf="!loading && filteredPrescriptions.length === 0" class="alert alert-info">
    <i class="fas fa-info-circle me-2"></i> No prescriptions found.
  </div>
</div>